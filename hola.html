<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impacto de Carbono</title>
</head>
<body>
    <!-- Donde quieras mostrar los datos -->
    <div id="impacto-carbono"></div>

    <script>
// Función para parsear CSV correctamente (soporta comillas y comas decimales)
function parseCSV(texto) {
    const filas = [];
    let fila = [];
    let valor = '';
    let dentroComillas = false;

    for (let i = 0; i < texto.length; i++) {
        const char = texto[i];
        if (char === '"') {
            dentroComillas = !dentroComillas;
        } else if (char === ',' && !dentroComillas) {
            fila.push(valor);
            valor = '';
        } else if ((char === '\n' || char === '\r') && !dentroComillas) {
            if (valor !== '' || fila.length > 0) {
                fila.push(valor);
                filas.push(fila);
                fila = [];
                valor = '';
            }
        } else {
            valor += char;
        }
    }
    // Añadir la última fila si existe
    if (valor !== '' || fila.length > 0) {
        fila.push(valor);
        filas.push(fila);
    }
    return filas;
}

async function cargarDatosImpacto() {
    const url = "https://docs.google.com/spreadsheets/d/1gxjvhn9qko__uwWrytHSCnUTdv3aBX_Fv0I9xjclLGs/export?format=csv&gid=920589068&t=" + new Date().getTime();
    const respuesta = await fetch(url, {cache: "no-store"});
    const texto = await respuesta.text();

    // Usar el parser robusto
    const filas = parseCSV(texto.trim());
    const encabezados = filas[0].map(e => e.replace(/"/g, '').trim());
    const datos = filas[1].map(e => e.replace(/"/g, '').trim());

    // Construir HTML bonito mostrando todas las columnas
    let html = `<table style="border-collapse:collapse; background:#f9f9f9; font-family:Montserrat,sans-serif; min-width:600px;">
        <tr style="background:#ffe082; color:#333;">
            <th style="padding:8px; border:1px solid #bbb;">${encabezados[0]}</th>
            <th style="padding:8px; border:1px solid #bbb;">${encabezados[1]}</th>
            <th style="padding:8px; border:1px solid #bbb;">${encabezados[2]}</th>
            <th style="padding:8px; border:1px solid #bbb;">${encabezados[3]}</th>
            <th style="padding:8px; border:1px solid #bbb;">${encabezados[4]}</th>
        </tr>
        <tr style="background:#e3f2fd;">
            <td style="padding:8px; border:1px solid #bbb;">${datos[0]}</td>
            <td style="padding:8px; border:1px solid #bbb;">${datos[1]}</td>
            <td style="padding:8px; border:1px solid #bbb;">${datos[2]}</td>
            <td style="padding:8px; border:1px solid #bbb;">${datos[3]}</td>
            <td style="padding:8px; border:1px solid #bbb;">${datos[4]}</td>
        </tr>
    </table>`;

    document.getElementById('impacto-carbono').innerHTML = html;
}

cargarDatosImpacto();
setInterval(cargarDatosImpacto, 10000);
</script>
</body>
</html>